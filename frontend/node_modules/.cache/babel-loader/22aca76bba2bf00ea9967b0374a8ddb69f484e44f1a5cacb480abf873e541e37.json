{"ast":null,"code":"import React,{useState,useEffect,useCallback}from'react';import{useNavigate}from'react-router-dom';import{Box,Card,CardContent,Typography,Button,Grid,Alert,Chip,Dialog,DialogTitle,DialogContent,DialogActions,TextField,Container,Avatar,IconButton,FormControl,InputLabel,Select,MenuItem,LinearProgress,Tooltip}from'@mui/material';import{ShoppingCart,Store as MarketIcon,AccountBalance as CreditIcon,TrendingUp as TrendIcon,Verified as VerifiedIcon,Nature as EcoIcon,LocationOn as LocationIcon,Logout as LogoutIcon,Refresh as RefreshIcon,FilterList as FilterIcon}from'@mui/icons-material';import{useSnackbar}from'notistack';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const Marketplace=()=>{const{enqueueSnackbar}=useSnackbar();const navigate=useNavigate();const[userInfo,setUserInfo]=useState(null);const[listings,setListings]=useState([]);const[loading,setLoading]=useState(true);const[purchaseDialog,setPurchaseDialog]=useState(false);const[selectedListing,setSelectedListing]=useState(null);const[quantity,setQuantity]=useState('');const[filter,setFilter]=useState('all');useEffect(()=>{// Get user info\nconst storedUserInfo=localStorage.getItem('userInfo');if(storedUserInfo){setUserInfo(JSON.parse(storedUserInfo));}loadListings();},[]);const loadListings=useCallback(async()=>{try{var _result$listings;setLoading(true);const response=await fetch('http://localhost:8002/api/marketplace');const result=await response.json();// Add mock data if empty\nconst mockListings=[{id:'LIST_001',project_id:'BC_PROD001',project_name:'Sundarbans Mangrove Restoration',ecosystem_type:'mangrove',credits_available:245,price_per_credit:500,seller:'Sundarbans Community Collective',location:'West Bengal Coast',verification_status:'verified',description:'High-quality carbon credits from community-led mangrove restoration',created_at:'2024-01-15T10:00:00Z',status:'active'},{id:'LIST_002',project_id:'BC_PROD002',project_name:'Tamil Nadu Seagrass Revival',ecosystem_type:'seagrass',credits_available:180,price_per_credit:450,seller:'Tamil Nadu Coastal Conservation',location:'Tamil Nadu Coast',verification_status:'verified',description:'Premium seagrass restoration carbon credits with biodiversity co-benefits',created_at:'2024-01-18T14:30:00Z',status:'active'},{id:'LIST_003',project_id:'BC_PROD003',project_name:'Odisha Salt Marsh Conservation',ecosystem_type:'salt_marsh',credits_available:120,price_per_credit:400,seller:'Odisha Wetland Foundation',location:'Odisha Coast',verification_status:'verified',description:'Salt marsh conservation credits supporting coastal resilience',created_at:'2024-01-20T09:15:00Z',status:'active'}];setListings(((_result$listings=result.listings)===null||_result$listings===void 0?void 0:_result$listings.length)>0?result.listings:mockListings);}catch(error){console.error('Error loading listings:',error);enqueueSnackbar('Failed to load marketplace listings',{variant:'error'});}finally{setLoading(false);}},[enqueueSnackbar]);useEffect(()=>{loadListings();},[loadListings]);const handlePurchase=async()=>{try{const purchaseData={listing_id:selectedListing.id,credits:parseInt(quantity),total_amount:parseInt(quantity)*selectedListing.price_per_credit,buyer_email:userInfo===null||userInfo===void 0?void 0:userInfo.email};const response=await fetch('http://localhost:8002/api/marketplace/purchase',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(purchaseData)});const result=await response.json();if(result.status==='success'){enqueueSnackbar(\"Successfully purchased \".concat(quantity,\" carbon credits!\"),{variant:'success'});setPurchaseDialog(false);setQuantity('');loadListings();// Refresh listings\n}else{throw new Error(result.message||'Purchase failed');}}catch(error){console.error('Purchase error:',error);enqueueSnackbar('Failed to complete purchase',{variant:'error'});}};const handleLogout=()=>{localStorage.removeItem('userInfo');localStorage.removeItem('auth_token');navigate('/login');};const getEcosystemIcon=type=>{switch(type){case'mangrove':return'ðŸŒ¿';case'seagrass':return'ðŸŒ±';case'salt_marsh':return'ðŸŒ¾';case'coastal_wetland':return'ðŸ’§';default:return'ðŸŒŠ';}};return/*#__PURE__*/_jsxs(Container,{maxWidth:\"xl\",sx:{mt:2,mb:4},children:[/*#__PURE__*/_jsx(Box,{sx:{mb:4},children:/*#__PURE__*/_jsxs(Box,{sx:{display:'flex',justifyContent:'space-between',alignItems:'flex-start',mb:2},children:[/*#__PURE__*/_jsxs(Box,{children:[/*#__PURE__*/_jsx(Typography,{variant:\"h3\",gutterBottom:true,children:\"\\uD83C\\uDFEA Carbon Credit Marketplace\"}),/*#__PURE__*/_jsx(Typography,{variant:\"h6\",color:\"textSecondary\",gutterBottom:true,children:\"Trade verified blue carbon credits from coastal restoration projects\"}),/*#__PURE__*/_jsx(Typography,{variant:\"subtitle1\",color:\"textSecondary\",children:userInfo?\"Welcome, \".concat(userInfo.email):'Marketplace Dashboard'})]}),/*#__PURE__*/_jsxs(Box,{sx:{display:'flex',gap:1},children:[/*#__PURE__*/_jsx(IconButton,{onClick:loadListings,color:\"primary\",children:/*#__PURE__*/_jsx(RefreshIcon,{})}),/*#__PURE__*/_jsx(Button,{variant:\"outlined\",color:\"error\",startIcon:/*#__PURE__*/_jsx(LogoutIcon,{}),onClick:handleLogout,children:\"Logout\"})]})]})}),/*#__PURE__*/_jsxs(Grid,{container:true,spacing:3,sx:{mb:4},children:[/*#__PURE__*/_jsx(Grid,{item:true,xs:12,sm:6,md:3,children:/*#__PURE__*/_jsx(Card,{children:/*#__PURE__*/_jsxs(CardContent,{children:[/*#__PURE__*/_jsxs(Box,{sx:{display:'flex',alignItems:'center',mb:1},children:[/*#__PURE__*/_jsx(Avatar,{sx:{bgcolor:'primary.main',mr:1},children:/*#__PURE__*/_jsx(CreditIcon,{})}),/*#__PURE__*/_jsx(Typography,{variant:\"h6\",children:\"Total Credits\"})]}),/*#__PURE__*/_jsx(Typography,{variant:\"h4\",color:\"primary.main\",children:listings.reduce((sum,l)=>sum+(l.credits_available||l.credit_amount||0),0).toLocaleString()}),/*#__PURE__*/_jsx(Typography,{variant:\"body2\",color:\"textSecondary\",children:\"Available for purchase\"})]})})}),/*#__PURE__*/_jsx(Grid,{item:true,xs:12,sm:6,md:3,children:/*#__PURE__*/_jsx(Card,{children:/*#__PURE__*/_jsxs(CardContent,{children:[/*#__PURE__*/_jsxs(Box,{sx:{display:'flex',alignItems:'center',mb:1},children:[/*#__PURE__*/_jsx(Avatar,{sx:{bgcolor:'success.main',mr:1},children:/*#__PURE__*/_jsx(TrendIcon,{})}),/*#__PURE__*/_jsx(Typography,{variant:\"h6\",children:\"Avg Price\"})]}),/*#__PURE__*/_jsxs(Typography,{variant:\"h4\",color:\"success.main\",children:[\"\\u20B9\",Math.round(listings.reduce((sum,l)=>sum+(l.price_per_credit||l.price||0),0)/(listings.length||1))]}),/*#__PURE__*/_jsx(Typography,{variant:\"body2\",color:\"textSecondary\",children:\"Per carbon credit\"})]})})}),/*#__PURE__*/_jsx(Grid,{item:true,xs:12,sm:6,md:3,children:/*#__PURE__*/_jsx(Card,{children:/*#__PURE__*/_jsxs(CardContent,{children:[/*#__PURE__*/_jsxs(Box,{sx:{display:'flex',alignItems:'center',mb:1},children:[/*#__PURE__*/_jsx(Avatar,{sx:{bgcolor:'info.main',mr:1},children:/*#__PURE__*/_jsx(MarketIcon,{})}),/*#__PURE__*/_jsx(Typography,{variant:\"h6\",children:\"Active Listings\"})]}),/*#__PURE__*/_jsx(Typography,{variant:\"h4\",color:\"info.main\",children:listings.length}),/*#__PURE__*/_jsx(Typography,{variant:\"body2\",color:\"textSecondary\",children:\"Projects selling credits\"})]})})}),/*#__PURE__*/_jsx(Grid,{item:true,xs:12,sm:6,md:3,children:/*#__PURE__*/_jsx(Card,{children:/*#__PURE__*/_jsxs(CardContent,{children:[/*#__PURE__*/_jsxs(Box,{sx:{display:'flex',alignItems:'center',mb:1},children:[/*#__PURE__*/_jsx(Avatar,{sx:{bgcolor:'warning.main',mr:1},children:/*#__PURE__*/_jsx(EcoIcon,{})}),/*#__PURE__*/_jsx(Typography,{variant:\"h6\",children:\"CO\\u2082 Offset\"})]}),/*#__PURE__*/_jsxs(Typography,{variant:\"h4\",color:\"warning.main\",children:[(listings.reduce((sum,l)=>sum+(l.credits_available||l.credit_amount||0),0)*1.0).toLocaleString(),\"t\"]}),/*#__PURE__*/_jsx(Typography,{variant:\"body2\",color:\"textSecondary\",children:\"Total CO\\u2082 equivalent\"})]})})})]}),/*#__PURE__*/_jsx(Alert,{severity:\"success\",sx:{mb:3},children:\"\\uD83C\\uDF0A Trade verified blue carbon credits from restoration projects | All credits are blockchain-verified\"}),/*#__PURE__*/_jsx(Grid,{container:true,spacing:3,children:listings.length===0?/*#__PURE__*/_jsx(Grid,{item:true,xs:12,children:/*#__PURE__*/_jsx(Card,{children:/*#__PURE__*/_jsxs(CardContent,{sx:{textAlign:'center',py:6},children:[/*#__PURE__*/_jsx(Typography,{variant:\"h6\",color:\"textSecondary\",gutterBottom:true,children:\"No carbon credits available\"}),/*#__PURE__*/_jsx(Typography,{variant:\"body2\",color:\"textSecondary\",children:\"Check back later for verified carbon credits from blue carbon projects\"})]})})}):listings.map(listing=>/*#__PURE__*/_jsx(Grid,{item:true,xs:12,md:6,lg:4,children:/*#__PURE__*/_jsx(Card,{children:/*#__PURE__*/_jsxs(CardContent,{children:[/*#__PURE__*/_jsxs(Box,{display:\"flex\",justifyContent:\"space-between\",alignItems:\"flex-start\",mb:2,children:[/*#__PURE__*/_jsxs(Typography,{variant:\"h6\",children:[listing.credit_amount,\" Credits\"]}),/*#__PURE__*/_jsx(Chip,{label:listing.status,color:\"primary\",size:\"small\"})]}),/*#__PURE__*/_jsxs(Typography,{variant:\"h4\",color:\"primary\",gutterBottom:true,children:[listing.price_per_credit,\" MATIC\"]}),/*#__PURE__*/_jsx(Typography,{variant:\"caption\",color:\"textSecondary\",display:\"block\",children:\"per credit\"}),/*#__PURE__*/_jsxs(Typography,{variant:\"body2\",sx:{mt:2,mb:2},children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Project:\"}),\" \",listing.project_id]}),/*#__PURE__*/_jsxs(Typography,{variant:\"body2\",sx:{mb:2},children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Total Value:\"}),\" \",listing.total_value,\" MATIC\"]}),/*#__PURE__*/_jsxs(Typography,{variant:\"body2\",sx:{mb:2},children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Certification:\"}),\" \",listing.certification_level||'Verified']}),/*#__PURE__*/_jsx(Typography,{variant:\"body2\",sx:{mb:3},children:listing.description}),/*#__PURE__*/_jsx(Button,{fullWidth:true,variant:\"contained\",startIcon:/*#__PURE__*/_jsx(ShoppingCart,{}),onClick:()=>{setSelectedListing(listing);setPurchaseDialog(true);},children:\"Purchase Credits\"})]})})},listing.listing_id))}),/*#__PURE__*/_jsxs(Dialog,{open:purchaseDialog,onClose:()=>setPurchaseDialog(false),maxWidth:\"sm\",fullWidth:true,children:[/*#__PURE__*/_jsx(DialogTitle,{children:\"Purchase Carbon Credits\"}),/*#__PURE__*/_jsx(DialogContent,{children:selectedListing&&/*#__PURE__*/_jsxs(Box,{children:[/*#__PURE__*/_jsxs(Typography,{gutterBottom:true,children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Available Credits:\"}),\" \",selectedListing.credit_amount]}),/*#__PURE__*/_jsxs(Typography,{gutterBottom:true,children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Price per Credit:\"}),\" \",selectedListing.price_per_credit,\" MATIC\"]}),/*#__PURE__*/_jsx(TextField,{fullWidth:true,type:\"number\",label:\"Quantity to Purchase\",value:quantity,onChange:e=>setQuantity(e.target.value),sx:{mt:2,mb:2},inputProps:{min:0.1,max:selectedListing.credit_amount,step:0.1}}),quantity&&/*#__PURE__*/_jsxs(Typography,{variant:\"h6\",color:\"primary\",children:[\"Total: \",(parseFloat(quantity)*selectedListing.price_per_credit).toFixed(2),\" MATIC\"]})]})}),/*#__PURE__*/_jsxs(DialogActions,{children:[/*#__PURE__*/_jsx(Button,{onClick:()=>setPurchaseDialog(false),children:\"Cancel\"}),/*#__PURE__*/_jsx(Button,{variant:\"contained\",onClick:handlePurchase,disabled:!quantity||parseFloat(quantity)<=0,children:\"Purchase\"})]})]})]});};export default Marketplace;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}
{"ast":null,"code":"import React,{useState,useEffect}from'react';import{useNavigate}from'react-router-dom';import{Box,Container,Typography,Grid,Card,CardContent,Button,AppBar,Toolbar,IconButton,Menu,MenuItem,Chip,LinearProgress,Alert,Paper,Table,TableBody,TableCell,TableContainer,TableHead,TableRow,Dialog,DialogTitle,DialogContent,DialogActions,TextField,FormControl,InputLabel,Select,Tabs,Tab,Badge,Avatar,List,ListItem,ListItemIcon,ListItemText,ListItemSecondaryAction}from'@mui/material';import{AdminPanelSettings as AdminIcon,AccountCircle as AccountIcon,CheckCircle as CheckCircleIcon,Cancel as CancelIcon,Visibility as ViewIcon,Assessment as AssessmentIcon,Schedule as ScheduleIcon,Warning as WarningIcon,ArrowBack as ArrowBackIcon,TrendingUp as TrendingUpIcon,Nature as NatureIcon,LocationOn as LocationIcon,Person as PersonIcon}from'@mui/icons-material';import{useAuth}from'../contexts/AuthContext';import{useSnackbar}from'notistack';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const AdminProjects=()=>{const navigate=useNavigate();const{user,logout}=useAuth();const{enqueueSnackbar}=useSnackbar();const[anchorEl,setAnchorEl]=useState(null);const[projects,setProjects]=useState([]);const[loading,setLoading]=useState(true);const[selectedProject,setSelectedProject]=useState(null);const[reviewDialogOpen,setReviewDialogOpen]=useState(false);const[tabValue,setTabValue]=useState(0);const[reviewDecision,setReviewDecision]=useState('');const[reviewComments,setReviewComments]=useState('');useEffect(()=>{fetchProjects();},[]);const fetchProjects=async()=>{try{const response=await fetch('http://localhost:8002/api/projects');const data=await response.json();if(data.status==='success'){setProjects(data.projects||[]);}}catch(error){console.error('Error fetching projects:',error);enqueueSnackbar('Failed to load projects',{variant:'error'});}finally{setLoading(false);}};const handleMenuOpen=event=>{setAnchorEl(event.currentTarget);};const handleMenuClose=()=>{setAnchorEl(null);};const handleLogout=()=>{logout();navigate('/');enqueueSnackbar('Logged out successfully',{variant:'success'});};const handleReviewProject=project=>{setSelectedProject(project);setReviewDialogOpen(true);setReviewDecision('');setReviewComments('');};const submitReview=async()=>{if(!reviewDecision){enqueueSnackbar('Please select a review decision',{variant:'warning'});return;}try{const response=await fetch(\"http://localhost:8002/api/admin/projects/\".concat(selectedProject.id,\"/review\"),{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({status:reviewDecision,comments:reviewComments,reviewed_by:(user===null||user===void 0?void 0:user.email)||'admin@nccr.gov.in',review_date:new Date().toISOString().split('T')[0]})});const data=await response.json();if(data.status==='success'){enqueueSnackbar('Project review submitted successfully!',{variant:'success'});setReviewDialogOpen(false);fetchProjects();// Refresh the projects list\n}else{enqueueSnackbar(data.message||'Failed to submit review',{variant:'error'});}}catch(error){console.error('Error submitting review:',error);enqueueSnackbar('Failed to submit review',{variant:'error'});}};const getProjectStatusColor=status=>{switch(status){case'approved':return'success';case'rejected':return'error';case'pending_verification':return'warning';case'requires_review':return'info';default:return'default';}};const getProjectStatusIcon=status=>{switch(status){case'approved':return/*#__PURE__*/_jsx(CheckCircleIcon,{});case'rejected':return/*#__PURE__*/_jsx(WarningIcon,{});case'pending_verification':return/*#__PURE__*/_jsx(ScheduleIcon,{});case'requires_review':return/*#__PURE__*/_jsx(AssessmentIcon,{});default:return/*#__PURE__*/_jsx(ScheduleIcon,{});}};const getFilteredProjects=()=>{switch(tabValue){case 0:return projects;// All projects\ncase 1:return projects.filter(p=>p.status==='requires_review');case 2:return projects.filter(p=>p.status==='approved');case 3:return projects.filter(p=>p.status==='rejected');default:return projects;}};const getProjectStats=()=>{const total=projects.length;const pending=projects.filter(p=>p.status==='requires_review').length;const approved=projects.filter(p=>p.status==='approved').length;const rejected=projects.filter(p=>p.status==='rejected').length;const totalCredits=projects.filter(p=>p.status==='approved').reduce((sum,p)=>sum+(p.carbon_credits||0),0);return{total,pending,approved,rejected,totalCredits};};const stats=getProjectStats();if(loading){return/*#__PURE__*/_jsx(Box,{sx:{width:'100%',mt:2},children:/*#__PURE__*/_jsx(LinearProgress,{})});}return/*#__PURE__*/_jsxs(Box,{children:[/*#__PURE__*/_jsx(AppBar,{position:\"static\",children:/*#__PURE__*/_jsxs(Toolbar,{children:[/*#__PURE__*/_jsx(IconButton,{edge:\"start\",color:\"inherit\",onClick:()=>navigate('/admin'),sx:{mr:2},children:/*#__PURE__*/_jsx(ArrowBackIcon,{})}),/*#__PURE__*/_jsx(AdminIcon,{sx:{mr:2}}),/*#__PURE__*/_jsx(Typography,{variant:\"h6\",component:\"div\",sx:{flexGrow:1},children:\"NCCR - Project Management\"}),/*#__PURE__*/_jsx(IconButton,{size:\"large\",edge:\"end\",\"aria-label\":\"account\",onClick:handleMenuOpen,color:\"inherit\",children:/*#__PURE__*/_jsx(AccountIcon,{})}),/*#__PURE__*/_jsxs(Menu,{anchorEl:anchorEl,open:Boolean(anchorEl),onClose:handleMenuClose,children:[/*#__PURE__*/_jsx(MenuItem,{onClick:()=>navigate('/admin'),children:\"Dashboard\"}),/*#__PURE__*/_jsx(MenuItem,{onClick:()=>navigate('/admin/analytics'),children:\"Analytics\"}),/*#__PURE__*/_jsx(MenuItem,{onClick:handleLogout,children:\"Logout\"})]})]})}),/*#__PURE__*/_jsxs(Container,{maxWidth:\"xl\",sx:{mt:4,mb:4},children:[/*#__PURE__*/_jsx(Paper,{elevation:3,sx:{p:3,mb:4,background:'linear-gradient(45deg, #e8f5e8, #f3e5f5)'},children:/*#__PURE__*/_jsxs(Grid,{container:true,alignItems:\"center\",spacing:3,children:[/*#__PURE__*/_jsx(Grid,{item:true,children:/*#__PURE__*/_jsx(Avatar,{sx:{width:60,height:60,bgcolor:'primary.main'},children:/*#__PURE__*/_jsx(AdminIcon,{})})}),/*#__PURE__*/_jsxs(Grid,{item:true,xs:true,children:[/*#__PURE__*/_jsx(Typography,{variant:\"h4\",gutterBottom:true,children:\"\\uD83C\\uDFDB\\uFE0F NCCR Project Review Center\"}),/*#__PURE__*/_jsx(Typography,{variant:\"subtitle1\",color:\"textSecondary\",children:\"Monitor and approve blue carbon restoration projects across India\"})]})]})}),/*#__PURE__*/_jsxs(Grid,{container:true,spacing:3,sx:{mb:4},children:[/*#__PURE__*/_jsx(Grid,{item:true,xs:12,sm:6,md:3,children:/*#__PURE__*/_jsx(Card,{children:/*#__PURE__*/_jsxs(CardContent,{sx:{textAlign:'center'},children:[/*#__PURE__*/_jsx(NatureIcon,{sx:{fontSize:40,color:'primary.main',mb:1}}),/*#__PURE__*/_jsx(Typography,{variant:\"h4\",color:\"primary\",children:stats.total}),/*#__PURE__*/_jsx(Typography,{color:\"textSecondary\",children:\"Total Projects\"})]})})}),/*#__PURE__*/_jsx(Grid,{item:true,xs:12,sm:6,md:3,children:/*#__PURE__*/_jsx(Card,{children:/*#__PURE__*/_jsxs(CardContent,{sx:{textAlign:'center'},children:[/*#__PURE__*/_jsx(Badge,{badgeContent:stats.pending,color:\"warning\",children:/*#__PURE__*/_jsx(AssessmentIcon,{sx:{fontSize:40,color:'warning.main',mb:1}})}),/*#__PURE__*/_jsx(Typography,{variant:\"h4\",color:\"warning.main\",children:stats.pending}),/*#__PURE__*/_jsx(Typography,{color:\"textSecondary\",children:\"Pending Review\"})]})})}),/*#__PURE__*/_jsx(Grid,{item:true,xs:12,sm:6,md:3,children:/*#__PURE__*/_jsx(Card,{children:/*#__PURE__*/_jsxs(CardContent,{sx:{textAlign:'center'},children:[/*#__PURE__*/_jsx(CheckCircleIcon,{sx:{fontSize:40,color:'success.main',mb:1}}),/*#__PURE__*/_jsx(Typography,{variant:\"h4\",color:\"success.main\",children:stats.approved}),/*#__PURE__*/_jsx(Typography,{color:\"textSecondary\",children:\"Approved Projects\"})]})})}),/*#__PURE__*/_jsx(Grid,{item:true,xs:12,sm:6,md:3,children:/*#__PURE__*/_jsx(Card,{children:/*#__PURE__*/_jsxs(CardContent,{sx:{textAlign:'center'},children:[/*#__PURE__*/_jsx(TrendingUpIcon,{sx:{fontSize:40,color:'info.main',mb:1}}),/*#__PURE__*/_jsx(Typography,{variant:\"h4\",color:\"info.main\",children:stats.totalCredits}),/*#__PURE__*/_jsx(Typography,{color:\"textSecondary\",children:\"Approved Credits (tCO\\u2082)\"})]})})})]}),/*#__PURE__*/_jsx(Card,{children:/*#__PURE__*/_jsxs(CardContent,{children:[/*#__PURE__*/_jsxs(Tabs,{value:tabValue,onChange:(e,newValue)=>setTabValue(newValue),sx:{mb:3},children:[/*#__PURE__*/_jsx(Tab,{label:\"All Projects\"}),/*#__PURE__*/_jsx(Tab,{label:/*#__PURE__*/_jsx(Badge,{badgeContent:stats.pending,color:\"error\",children:\"Pending Review\"})}),/*#__PURE__*/_jsx(Tab,{label:\"Approved\"}),/*#__PURE__*/_jsx(Tab,{label:\"Rejected\"})]}),getFilteredProjects().length===0?/*#__PURE__*/_jsx(Alert,{severity:\"info\",sx:{mt:2},children:\"No projects found in this category.\"}):/*#__PURE__*/_jsx(TableContainer,{component:Paper,elevation:0,children:/*#__PURE__*/_jsxs(Table,{children:[/*#__PURE__*/_jsx(TableHead,{children:/*#__PURE__*/_jsxs(TableRow,{children:[/*#__PURE__*/_jsx(TableCell,{children:/*#__PURE__*/_jsx(\"strong\",{children:\"Project Details\"})}),/*#__PURE__*/_jsx(TableCell,{children:/*#__PURE__*/_jsx(\"strong\",{children:\"Location & Area\"})}),/*#__PURE__*/_jsx(TableCell,{children:/*#__PURE__*/_jsx(\"strong\",{children:\"Status\"})}),/*#__PURE__*/_jsx(TableCell,{children:/*#__PURE__*/_jsx(\"strong\",{children:\"Carbon Credits\"})}),/*#__PURE__*/_jsx(TableCell,{children:/*#__PURE__*/_jsx(\"strong\",{children:\"AI Score\"})}),/*#__PURE__*/_jsx(TableCell,{children:/*#__PURE__*/_jsx(\"strong\",{children:\"Actions\"})})]})}),/*#__PURE__*/_jsx(TableBody,{children:getFilteredProjects().map(project=>{var _project$status;return/*#__PURE__*/_jsxs(TableRow,{hover:true,children:[/*#__PURE__*/_jsx(TableCell,{children:/*#__PURE__*/_jsxs(Box,{children:[/*#__PURE__*/_jsx(Typography,{variant:\"subtitle2\",fontWeight:\"bold\",children:project.project_name}),/*#__PURE__*/_jsxs(Typography,{variant:\"body2\",color:\"textSecondary\",children:[project.ecosystem_type,\" \\u2022 Submitted by: \",project.submitted_by||'Community User']})]})}),/*#__PURE__*/_jsx(TableCell,{children:/*#__PURE__*/_jsxs(Box,{children:[/*#__PURE__*/_jsxs(Typography,{variant:\"body2\",children:[\"\\uD83D\\uDCCD \",project.location]}),/*#__PURE__*/_jsxs(Typography,{variant:\"body2\",color:\"textSecondary\",children:[project.area_hectares,\" hectares\"]})]})}),/*#__PURE__*/_jsx(TableCell,{children:/*#__PURE__*/_jsx(Chip,{icon:getProjectStatusIcon(project.status),label:(_project$status=project.status)===null||_project$status===void 0?void 0:_project$status.replace('_',' ').toUpperCase(),color:getProjectStatusColor(project.status),size:\"small\"})}),/*#__PURE__*/_jsx(TableCell,{children:/*#__PURE__*/_jsxs(Typography,{variant:\"body2\",color:\"primary\",fontWeight:\"bold\",children:[project.carbon_credits||project.expected_carbon_credits||0,\" tCO\\u2082\"]})}),/*#__PURE__*/_jsx(TableCell,{children:project.verification_score?/*#__PURE__*/_jsx(Chip,{label:\"\".concat(project.verification_score,\"/100\"),color:project.verification_score>=80?'success':project.verification_score>=60?'warning':'error',variant:\"outlined\",size:\"small\"}):/*#__PURE__*/_jsx(Typography,{variant:\"body2\",color:\"textSecondary\",children:\"Pending\"})}),/*#__PURE__*/_jsx(TableCell,{children:/*#__PURE__*/_jsx(Button,{variant:\"contained\",size:\"small\",startIcon:/*#__PURE__*/_jsx(AssessmentIcon,{}),onClick:()=>handleReviewProject(project),disabled:project.status==='approved'||project.status==='rejected',children:\"Review\"})})]},project.id);})})]})})]})})]}),/*#__PURE__*/_jsxs(Dialog,{open:reviewDialogOpen,onClose:()=>setReviewDialogOpen(false),maxWidth:\"md\",fullWidth:true,children:[/*#__PURE__*/_jsx(DialogTitle,{children:\"\\uD83D\\uDD0D Project Review - NCCR Assessment\"}),/*#__PURE__*/_jsx(DialogContent,{children:selectedProject&&/*#__PURE__*/_jsxs(Grid,{container:true,spacing:3,sx:{mt:1},children:[/*#__PURE__*/_jsx(Grid,{item:true,xs:12,children:/*#__PURE__*/_jsxs(Paper,{elevation:1,sx:{p:2,mb:2},children:[/*#__PURE__*/_jsx(Typography,{variant:\"h6\",gutterBottom:true,children:\"\\uD83D\\uDCCB Project Information\"}),/*#__PURE__*/_jsxs(Grid,{container:true,spacing:2,children:[/*#__PURE__*/_jsxs(Grid,{item:true,xs:12,sm:6,children:[/*#__PURE__*/_jsx(Typography,{variant:\"subtitle2\",color:\"textSecondary\",children:\"Project Name\"}),/*#__PURE__*/_jsx(Typography,{variant:\"body1\",fontWeight:\"bold\",children:selectedProject.project_name})]}),/*#__PURE__*/_jsxs(Grid,{item:true,xs:12,sm:6,children:[/*#__PURE__*/_jsx(Typography,{variant:\"subtitle2\",color:\"textSecondary\",children:\"Ecosystem Type\"}),/*#__PURE__*/_jsx(Typography,{variant:\"body1\",children:selectedProject.ecosystem_type})]}),/*#__PURE__*/_jsxs(Grid,{item:true,xs:12,sm:6,children:[/*#__PURE__*/_jsx(Typography,{variant:\"subtitle2\",color:\"textSecondary\",children:\"Location\"}),/*#__PURE__*/_jsx(Typography,{variant:\"body1\",children:selectedProject.location})]}),/*#__PURE__*/_jsxs(Grid,{item:true,xs:12,sm:6,children:[/*#__PURE__*/_jsx(Typography,{variant:\"subtitle2\",color:\"textSecondary\",children:\"Area\"}),/*#__PURE__*/_jsxs(Typography,{variant:\"body1\",children:[selectedProject.area_hectares,\" hectares\"]})]}),/*#__PURE__*/_jsxs(Grid,{item:true,xs:12,children:[/*#__PURE__*/_jsx(Typography,{variant:\"subtitle2\",color:\"textSecondary\",children:\"Description\"}),/*#__PURE__*/_jsx(Typography,{variant:\"body1\",children:selectedProject.description})]})]})]})}),selectedProject.verification_score&&/*#__PURE__*/_jsx(Grid,{item:true,xs:12,children:/*#__PURE__*/_jsxs(Paper,{elevation:1,sx:{p:2,mb:2},children:[/*#__PURE__*/_jsx(Typography,{variant:\"h6\",gutterBottom:true,children:\"\\uD83E\\uDD16 AI Verification Results\"}),/*#__PURE__*/_jsxs(Grid,{container:true,spacing:2,children:[/*#__PURE__*/_jsxs(Grid,{item:true,xs:12,sm:6,children:[/*#__PURE__*/_jsx(Typography,{variant:\"subtitle2\",color:\"textSecondary\",children:\"Verification Score\"}),/*#__PURE__*/_jsx(Chip,{label:\"\".concat(selectedProject.verification_score,\"/100\"),color:selectedProject.verification_score>=80?'success':selectedProject.verification_score>=60?'warning':'error',size:\"large\"})]}),/*#__PURE__*/_jsxs(Grid,{item:true,xs:12,sm:6,children:[/*#__PURE__*/_jsx(Typography,{variant:\"subtitle2\",color:\"textSecondary\",children:\"Risk Assessment\"}),/*#__PURE__*/_jsx(Typography,{variant:\"body1\",children:selectedProject.verification_score>=80?'Low Risk':selectedProject.verification_score>=60?'Medium Risk':'High Risk'})]})]})]})}),/*#__PURE__*/_jsx(Grid,{item:true,xs:12,children:/*#__PURE__*/_jsxs(FormControl,{fullWidth:true,required:true,sx:{mb:2},children:[/*#__PURE__*/_jsx(InputLabel,{children:\"Review Decision\"}),/*#__PURE__*/_jsxs(Select,{value:reviewDecision,label:\"Review Decision\",onChange:e=>setReviewDecision(e.target.value),children:[/*#__PURE__*/_jsx(MenuItem,{value:\"approved\",children:\"\\u2705 Approve Project\"}),/*#__PURE__*/_jsx(MenuItem,{value:\"rejected\",children:\"\\u274C Reject Project\"}),/*#__PURE__*/_jsx(MenuItem,{value:\"requires_revision\",children:\"\\uD83D\\uDCDD Request Revision\"})]})]})}),/*#__PURE__*/_jsx(Grid,{item:true,xs:12,children:/*#__PURE__*/_jsx(TextField,{fullWidth:true,label:\"Review Comments\",multiline:true,rows:4,value:reviewComments,onChange:e=>setReviewComments(e.target.value),placeholder:\"Provide detailed feedback for the community...\",required:true})})]})}),/*#__PURE__*/_jsxs(DialogActions,{children:[/*#__PURE__*/_jsx(Button,{onClick:()=>setReviewDialogOpen(false),children:\"Cancel\"}),/*#__PURE__*/_jsx(Button,{onClick:submitReview,variant:\"contained\",disabled:!reviewDecision||!reviewComments,children:\"Submit Review\"})]})]})]});};export default AdminProjects;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}
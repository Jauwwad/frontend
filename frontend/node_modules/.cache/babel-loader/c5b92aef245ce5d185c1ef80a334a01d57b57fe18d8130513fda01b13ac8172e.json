{"ast":null,"code":"import _objectSpread from\"/Users/razashaikh/Desktop/sih/python-app/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useState,useEffect}from'react';import{useNavigate}from'react-router-dom';import{Container,Typography,Box,Card,CardContent,Button,Grid,Alert,Chip,Dialog,DialogTitle,DialogContent,DialogActions,TextField,Table,TableBody,TableCell,TableContainer,TableHead,TableRow,IconButton,Tooltip,CircularProgress,Avatar,Divider,FormControl,InputLabel,Select,MenuItem}from'@mui/material';// Import only necessary icons to avoid circular dependencies\nimport SendIcon from'@mui/icons-material/Send';import AccountBalanceIcon from'@mui/icons-material/AccountBalance';import PaymentIcon from'@mui/icons-material/Payment';import ReceiptIcon from'@mui/icons-material/Receipt';import CheckCircleIcon from'@mui/icons-material/CheckCircle';import PendingIcon from'@mui/icons-material/Pending';import ErrorIcon from'@mui/icons-material/Error';import RefreshIcon from'@mui/icons-material/Refresh';import AccountBalanceWalletIcon from'@mui/icons-material/AccountBalanceWallet';import SwapHorizIcon from'@mui/icons-material/SwapHoriz';import LogoutIcon from'@mui/icons-material/Logout';import AddIcon from'@mui/icons-material/Add';import RemoveIcon from'@mui/icons-material/Remove';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const PaymentDistribution=()=>{const navigate=useNavigate();const[userInfo,setUserInfo]=useState(null);const[loading,setLoading]=useState(false);// Transfer dialog state\nconst[transferDialog,setTransferDialog]=useState(false);const[transferData,setTransferData]=useState({recipient_address:'',amount:'',token_type:'BCC',purpose:''});// Data states\nconst[wallet,setWallet]=useState(null);const[transferHistory,setTransferHistory]=useState([]);const[recipients,setRecipients]=useState([]);const[paymentStats,setPaymentStats]=useState(null);useEffect(()=>{// Get user info\nconst storedUserInfo=localStorage.getItem('userInfo');if(storedUserInfo){setUserInfo(JSON.parse(storedUserInfo));}fetchPaymentData();},[]);const fetchPaymentData=async()=>{setLoading(true);try{// Mock wallet data\nsetWallet({address:'0x742d35Cc6634C0532925a3b8D5c65E1c3F1234AB',bcc_balance:245.8,matic_balance:15.67,inr_equivalent:7374.0});// Mock transfer history\nsetTransferHistory([{id:'TXN_001',type:'sent',amount:50.0,token:'BCC',recipient:'0x1234567890abcdef1234567890abcdef12345678',recipient_name:'Sundarbans Community Group',purpose:'Project revenue share',timestamp:'2024-03-15T10:30:00Z',status:'completed',tx_hash:'0xabc123def456ghi789jkl012mno345pqr678stu901',gas_fee:0.002},{id:'TXN_002',type:'received',amount:89.3,token:'BCC',sender:'0x9876543210fedcba9876543210fedcba98765432',sender_name:'Carbon Credit Marketplace',purpose:'Credit sale payment',timestamp:'2024-03-10T14:15:00Z',status:'completed',tx_hash:'0xdef456ghi789jkl012mno345pqr678stu901abc123',gas_fee:0.0015},{id:'TXN_003',type:'sent',amount:25.5,token:'BCC',recipient:'0xabcdef1234567890abcdef1234567890abcdef12',recipient_name:'Kerala Fisherman Cooperative',purpose:'Community benefit sharing',timestamp:'2024-03-08T09:45:00Z',status:'pending',tx_hash:'0x123456789abcdef123456789abcdef123456789ab',gas_fee:0.0018}]);// Mock saved recipients\nsetRecipients([{name:'Sundarbans Community Group',address:'0x1234567890abcdef1234567890abcdef12345678',type:'Community'},{name:'Kerala Fisherman Cooperative',address:'0xabcdef1234567890abcdef1234567890abcdef12',type:'Community'},{name:'NCCR Research Fund',address:'0x742d35Cc6634C0532925a3b8D5c65E1c3F1234AB',type:'Government'}]);// Mock payment statistics\nsetPaymentStats({total_sent:125.5,total_received:189.3,pending_payments:1,completed_payments:2,total_gas_fees:0.0053});}catch(error){console.error('Error fetching payment data:',error);}finally{setLoading(false);}};const handleTransfer=async()=>{if(!transferData.recipient_address||!transferData.amount){alert('Please fill in recipient address and amount');return;}const amount=parseFloat(transferData.amount);if(amount<=0||amount>wallet.bcc_balance){alert('Invalid amount or insufficient balance');return;}setLoading(true);try{const response=await fetch('http://localhost:8002/api/payments/transfer',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({from_address:wallet.address,to_address:transferData.recipient_address,amount:amount,token_type:transferData.token_type,purpose:transferData.purpose,user_id:(userInfo===null||userInfo===void 0?void 0:userInfo.email)||'user'})});if(response.ok){const result=await response.json();alert(\"Transfer initiated successfully! Transaction ID: \".concat(result.transaction_id));setTransferDialog(false);setTransferData({recipient_address:'',amount:'',token_type:'BCC',purpose:''});fetchPaymentData();// Refresh data\n}else{const error=await response.json();alert(\"Transfer failed: \".concat(error.message));}}catch(error){console.error('Error initiating transfer:',error);alert('Error initiating transfer');}finally{setLoading(false);}};const handleQuickRecipient=recipient=>{setTransferData(_objectSpread(_objectSpread({},transferData),{},{recipient_address:recipient.address}));};const handleLogout=()=>{localStorage.removeItem('userInfo');localStorage.removeItem('auth_token');navigate('/login');};const getStatusColor=status=>{switch(status){case'completed':return'success';case'pending':return'warning';case'failed':return'error';default:return'default';}};const getStatusIcon=status=>{switch(status){case'completed':return/*#__PURE__*/_jsx(CheckCircleIcon,{});case'pending':return/*#__PURE__*/_jsx(PendingIcon,{});case'failed':return/*#__PURE__*/_jsx(ErrorIcon,{});default:return/*#__PURE__*/_jsx(PendingIcon,{});}};const formatAddress=address=>{if(!address)return'';return\"\".concat(address.substring(0,6),\"...\").concat(address.substring(address.length-4));};return/*#__PURE__*/_jsxs(Container,{maxWidth:\"xl\",sx:{mt:2,mb:4},children:[/*#__PURE__*/_jsx(Box,{sx:{mb:4},children:/*#__PURE__*/_jsxs(Box,{sx:{display:'flex',justifyContent:'space-between',alignItems:'flex-start',mb:2},children:[/*#__PURE__*/_jsxs(Box,{children:[/*#__PURE__*/_jsx(Typography,{variant:\"h3\",gutterBottom:true,children:\"\\uD83D\\uDCB3 Payment Distribution\"}),/*#__PURE__*/_jsx(Typography,{variant:\"h6\",color:\"textSecondary\",gutterBottom:true,children:\"Blockchain-based carbon credit transfers and payments\"}),/*#__PURE__*/_jsx(Typography,{variant:\"subtitle1\",color:\"textSecondary\",children:userInfo?\"User: \".concat(userInfo.email):'Guest Access'})]}),/*#__PURE__*/_jsxs(Box,{sx:{display:'flex',gap:1},children:[/*#__PURE__*/_jsx(IconButton,{onClick:fetchPaymentData,color:\"primary\",children:/*#__PURE__*/_jsx(RefreshIcon,{})}),/*#__PURE__*/_jsx(Button,{variant:\"contained\",startIcon:/*#__PURE__*/_jsx(SendIcon,{}),onClick:()=>setTransferDialog(true),children:\"New Transfer\"}),/*#__PURE__*/_jsx(Button,{variant:\"outlined\",color:\"error\",startIcon:/*#__PURE__*/_jsx(LogoutIcon,{}),onClick:handleLogout,children:\"Logout\"})]})]})}),wallet&&/*#__PURE__*/_jsxs(Grid,{container:true,spacing:3,sx:{mb:4},children:[/*#__PURE__*/_jsx(Grid,{item:true,xs:12,md:3,children:/*#__PURE__*/_jsx(Card,{children:/*#__PURE__*/_jsxs(CardContent,{children:[/*#__PURE__*/_jsxs(Box,{sx:{display:'flex',alignItems:'center',mb:1},children:[/*#__PURE__*/_jsx(Avatar,{sx:{bgcolor:'primary.main',mr:1},children:/*#__PURE__*/_jsx(AccountBalanceWalletIcon,{})}),/*#__PURE__*/_jsx(Typography,{variant:\"h6\",children:\"BCC Balance\"})]}),/*#__PURE__*/_jsx(Typography,{variant:\"h4\",color:\"primary.main\",children:wallet.bcc_balance.toFixed(2)}),/*#__PURE__*/_jsx(Typography,{variant:\"body2\",color:\"textSecondary\",children:\"Blue Carbon Credits\"})]})})}),/*#__PURE__*/_jsx(Grid,{item:true,xs:12,md:3,children:/*#__PURE__*/_jsx(Card,{children:/*#__PURE__*/_jsxs(CardContent,{children:[/*#__PURE__*/_jsxs(Box,{sx:{display:'flex',alignItems:'center',mb:1},children:[/*#__PURE__*/_jsx(Avatar,{sx:{bgcolor:'secondary.main',mr:1},children:/*#__PURE__*/_jsx(PaymentIcon,{})}),/*#__PURE__*/_jsx(Typography,{variant:\"h6\",children:\"MATIC Balance\"})]}),/*#__PURE__*/_jsx(Typography,{variant:\"h4\",color:\"secondary.main\",children:wallet.matic_balance.toFixed(3)}),/*#__PURE__*/_jsx(Typography,{variant:\"body2\",color:\"textSecondary\",children:\"For gas fees\"})]})})}),/*#__PURE__*/_jsx(Grid,{item:true,xs:12,md:3,children:/*#__PURE__*/_jsx(Card,{children:/*#__PURE__*/_jsxs(CardContent,{children:[/*#__PURE__*/_jsxs(Box,{sx:{display:'flex',alignItems:'center',mb:1},children:[/*#__PURE__*/_jsx(Avatar,{sx:{bgcolor:'success.main',mr:1},children:/*#__PURE__*/_jsx(AccountBalanceIcon,{})}),/*#__PURE__*/_jsx(Typography,{variant:\"h6\",children:\"INR Value\"})]}),/*#__PURE__*/_jsxs(Typography,{variant:\"h4\",color:\"success.main\",children:[\"\\u20B9\",wallet.inr_equivalent.toLocaleString()]}),/*#__PURE__*/_jsx(Typography,{variant:\"body2\",color:\"textSecondary\",children:\"Approximate value\"})]})})}),/*#__PURE__*/_jsx(Grid,{item:true,xs:12,md:3,children:/*#__PURE__*/_jsx(Card,{children:/*#__PURE__*/_jsxs(CardContent,{children:[/*#__PURE__*/_jsx(Typography,{variant:\"h6\",gutterBottom:true,children:\"Wallet Address\"}),/*#__PURE__*/_jsx(Chip,{label:formatAddress(wallet.address),size:\"small\",sx:{mb:1}}),/*#__PURE__*/_jsx(Typography,{variant:\"body2\",color:\"textSecondary\",children:\"Click to copy full address\"})]})})})]}),paymentStats&&/*#__PURE__*/_jsx(Card,{sx:{mb:4},children:/*#__PURE__*/_jsxs(CardContent,{children:[/*#__PURE__*/_jsx(Typography,{variant:\"h6\",gutterBottom:true,children:\"\\uD83D\\uDCCA Payment Statistics\"}),/*#__PURE__*/_jsxs(Grid,{container:true,spacing:3,children:[/*#__PURE__*/_jsx(Grid,{item:true,xs:6,md:2,children:/*#__PURE__*/_jsxs(Box,{sx:{textAlign:'center'},children:[/*#__PURE__*/_jsx(Typography,{variant:\"h4\",color:\"success.main\",children:paymentStats.total_received.toFixed(1)}),/*#__PURE__*/_jsx(Typography,{variant:\"body2\",color:\"textSecondary\",children:\"Total Received\"})]})}),/*#__PURE__*/_jsx(Grid,{item:true,xs:6,md:2,children:/*#__PURE__*/_jsxs(Box,{sx:{textAlign:'center'},children:[/*#__PURE__*/_jsx(Typography,{variant:\"h4\",color:\"warning.main\",children:paymentStats.total_sent.toFixed(1)}),/*#__PURE__*/_jsx(Typography,{variant:\"body2\",color:\"textSecondary\",children:\"Total Sent\"})]})}),/*#__PURE__*/_jsx(Grid,{item:true,xs:6,md:2,children:/*#__PURE__*/_jsxs(Box,{sx:{textAlign:'center'},children:[/*#__PURE__*/_jsx(Typography,{variant:\"h4\",color:\"primary.main\",children:paymentStats.completed_payments}),/*#__PURE__*/_jsx(Typography,{variant:\"body2\",color:\"textSecondary\",children:\"Completed\"})]})}),/*#__PURE__*/_jsx(Grid,{item:true,xs:6,md:2,children:/*#__PURE__*/_jsxs(Box,{sx:{textAlign:'center'},children:[/*#__PURE__*/_jsx(Typography,{variant:\"h4\",color:\"info.main\",children:paymentStats.pending_payments}),/*#__PURE__*/_jsx(Typography,{variant:\"body2\",color:\"textSecondary\",children:\"Pending\"})]})}),/*#__PURE__*/_jsx(Grid,{item:true,xs:6,md:2,children:/*#__PURE__*/_jsxs(Box,{sx:{textAlign:'center'},children:[/*#__PURE__*/_jsx(Typography,{variant:\"h4\",color:\"error.main\",children:paymentStats.total_gas_fees.toFixed(4)}),/*#__PURE__*/_jsx(Typography,{variant:\"body2\",color:\"textSecondary\",children:\"Gas Fees (MATIC)\"})]})})]})]})}),/*#__PURE__*/_jsx(Card,{sx:{mb:4},children:/*#__PURE__*/_jsxs(CardContent,{children:[/*#__PURE__*/_jsx(Typography,{variant:\"h6\",gutterBottom:true,children:\"\\uD83D\\uDCCB Recent Transfers\"}),/*#__PURE__*/_jsx(TableContainer,{children:/*#__PURE__*/_jsxs(Table,{children:[/*#__PURE__*/_jsx(TableHead,{children:/*#__PURE__*/_jsxs(TableRow,{children:[/*#__PURE__*/_jsx(TableCell,{children:\"Type\"}),/*#__PURE__*/_jsx(TableCell,{children:\"Amount\"}),/*#__PURE__*/_jsx(TableCell,{children:\"Counterparty\"}),/*#__PURE__*/_jsx(TableCell,{children:\"Purpose\"}),/*#__PURE__*/_jsx(TableCell,{children:\"Status\"}),/*#__PURE__*/_jsx(TableCell,{children:\"Date\"}),/*#__PURE__*/_jsx(TableCell,{children:\"Transaction\"})]})}),/*#__PURE__*/_jsx(TableBody,{children:transferHistory.map(transfer=>/*#__PURE__*/_jsxs(TableRow,{children:[/*#__PURE__*/_jsx(TableCell,{children:/*#__PURE__*/_jsx(Chip,{icon:transfer.type==='sent'?/*#__PURE__*/_jsx(RemoveIcon,{}):/*#__PURE__*/_jsx(AddIcon,{}),label:transfer.type.toUpperCase(),color:transfer.type==='sent'?'warning':'success',size:\"small\"})}),/*#__PURE__*/_jsxs(TableCell,{children:[/*#__PURE__*/_jsxs(Typography,{variant:\"body2\",fontWeight:\"bold\",children:[transfer.amount,\" \",transfer.token]}),/*#__PURE__*/_jsxs(Typography,{variant:\"caption\",color:\"textSecondary\",children:[\"Gas: \",transfer.gas_fee,\" MATIC\"]})]}),/*#__PURE__*/_jsxs(TableCell,{children:[/*#__PURE__*/_jsx(Typography,{variant:\"body2\",children:transfer.recipient_name||transfer.sender_name}),/*#__PURE__*/_jsx(Typography,{variant:\"caption\",color:\"textSecondary\",children:formatAddress(transfer.recipient||transfer.sender)})]}),/*#__PURE__*/_jsx(TableCell,{children:/*#__PURE__*/_jsx(Typography,{variant:\"body2\",children:transfer.purpose})}),/*#__PURE__*/_jsx(TableCell,{children:/*#__PURE__*/_jsx(Chip,{icon:getStatusIcon(transfer.status),label:transfer.status.toUpperCase(),color:getStatusColor(transfer.status),size:\"small\"})}),/*#__PURE__*/_jsx(TableCell,{children:new Date(transfer.timestamp).toLocaleDateString()}),/*#__PURE__*/_jsx(TableCell,{children:/*#__PURE__*/_jsx(Tooltip,{title:\"View on Blockchain\",children:/*#__PURE__*/_jsx(IconButton,{size:\"small\",onClick:()=>window.open(\"https://mumbai.polygonscan.com/tx/\".concat(transfer.tx_hash),'_blank'),children:/*#__PURE__*/_jsx(ReceiptIcon,{})})})})]},transfer.id))})]})})]})}),/*#__PURE__*/_jsxs(Dialog,{open:transferDialog,onClose:()=>setTransferDialog(false),maxWidth:\"md\",fullWidth:true,children:[/*#__PURE__*/_jsx(DialogTitle,{children:\"\\uD83D\\uDCB8 Send Carbon Credits\"}),/*#__PURE__*/_jsx(DialogContent,{children:/*#__PURE__*/_jsxs(Box,{sx:{mt:2},children:[/*#__PURE__*/_jsx(Typography,{variant:\"h6\",gutterBottom:true,children:\"Quick Recipients\"}),/*#__PURE__*/_jsx(Grid,{container:true,spacing:1,sx:{mb:3},children:recipients.map((recipient,index)=>/*#__PURE__*/_jsx(Grid,{item:true,children:/*#__PURE__*/_jsx(Chip,{label:recipient.name,variant:\"outlined\",clickable:true,onClick:()=>handleQuickRecipient(recipient),sx:{mb:1}})},index))}),/*#__PURE__*/_jsx(Divider,{sx:{mb:3}}),/*#__PURE__*/_jsx(TextField,{fullWidth:true,label:\"Recipient Address\",value:transferData.recipient_address,onChange:e=>setTransferData(_objectSpread(_objectSpread({},transferData),{},{recipient_address:e.target.value})),sx:{mb:2},helperText:\"Ethereum wallet address of the recipient\"}),/*#__PURE__*/_jsxs(Grid,{container:true,spacing:2,sx:{mb:2},children:[/*#__PURE__*/_jsx(Grid,{item:true,xs:8,children:/*#__PURE__*/_jsx(TextField,{fullWidth:true,type:\"number\",label:\"Amount\",value:transferData.amount,onChange:e=>setTransferData(_objectSpread(_objectSpread({},transferData),{},{amount:e.target.value})),helperText:\"Available: \".concat((wallet===null||wallet===void 0?void 0:wallet.bcc_balance)||0,\" BCC\"),inputProps:{min:0,max:(wallet===null||wallet===void 0?void 0:wallet.bcc_balance)||0,step:0.1}})}),/*#__PURE__*/_jsx(Grid,{item:true,xs:4,children:/*#__PURE__*/_jsxs(FormControl,{fullWidth:true,children:[/*#__PURE__*/_jsx(InputLabel,{children:\"Token\"}),/*#__PURE__*/_jsx(Select,{value:transferData.token_type,label:\"Token\",onChange:e=>setTransferData(_objectSpread(_objectSpread({},transferData),{},{token_type:e.target.value})),children:/*#__PURE__*/_jsx(MenuItem,{value:\"BCC\",children:\"BCC (Blue Carbon Credits)\"})})]})})]}),/*#__PURE__*/_jsx(TextField,{fullWidth:true,label:\"Purpose (Optional)\",value:transferData.purpose,onChange:e=>setTransferData(_objectSpread(_objectSpread({},transferData),{},{purpose:e.target.value})),placeholder:\"e.g., Project revenue share, Community benefit payment\",helperText:\"Description of the transfer purpose\"}),transferData.amount&&transferData.recipient_address&&/*#__PURE__*/_jsxs(Card,{variant:\"outlined\",sx:{mt:3,p:2,bgcolor:'grey.50'},children:[/*#__PURE__*/_jsx(Typography,{variant:\"h6\",gutterBottom:true,children:\"Transfer Preview\"}),/*#__PURE__*/_jsxs(Typography,{variant:\"body2\",children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Amount:\"}),\" \",transferData.amount,\" \",transferData.token_type]}),/*#__PURE__*/_jsxs(Typography,{variant:\"body2\",children:[/*#__PURE__*/_jsx(\"strong\",{children:\"To:\"}),\" \",formatAddress(transferData.recipient_address)]}),/*#__PURE__*/_jsxs(Typography,{variant:\"body2\",children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Estimated Gas:\"}),\" ~0.002 MATIC\"]}),/*#__PURE__*/_jsxs(Typography,{variant:\"body2\",color:\"textSecondary\",children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Network:\"}),\" Polygon Mumbai Testnet\"]})]})]})}),/*#__PURE__*/_jsxs(DialogActions,{children:[/*#__PURE__*/_jsx(Button,{onClick:()=>setTransferDialog(false),children:\"Cancel\"}),/*#__PURE__*/_jsx(Button,{variant:\"contained\",onClick:handleTransfer,disabled:loading||!transferData.recipient_address||!transferData.amount,startIcon:loading?/*#__PURE__*/_jsx(CircularProgress,{size:20}):/*#__PURE__*/_jsx(SwapHorizIcon,{}),children:loading?'Processing...':'Send Transfer'})]})]}),/*#__PURE__*/_jsxs(Alert,{severity:\"info\",sx:{mt:3},children:[\"\\uD83D\\uDD10 \",/*#__PURE__*/_jsx(\"strong\",{children:\"Secure Transfers:\"}),\" All transactions are recorded on the Polygon blockchain for transparency and immutability. Gas fees are automatically calculated and deducted from your MATIC balance.\"]})]});};export default PaymentDistribution;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}